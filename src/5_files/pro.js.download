(function(){function g(b,a,d){I.user.id?(loading("Upgrading to Pro"),$.ajax({url:"/ajax_pro_signup",type:"post",dataType:"json",data:{type:b,token:a.id,email:a.email},success:function(a){loading(!1);if(a.error)error_dialog(a.error);else{I.user.pro_type=b;BOX.hide();e(b,"Stripe Success "+d);a='<div class="pro-success-popup">'+("<p><b>Congratulations, "+esc(I.user.user)+"!</b></p>");a="pro"===b?a+"<p>You've upgraded to Imgflip Pro! Enjoy your ad-free and watermark-free GIF & meme making!</p>":a+"<p>You've upgraded to Imgflip Pro Basic! Enjoy your ad-free and watermark-free meme generating!</p>";
a+="<p>Feel free to contact us at general@imgflip.com if you have any questions or comments.</p>";var c=location.pathname;"/pro"===c&&(a+='<a href="/gif-maker" class="b but">GIF Maker</a>');if("/pro"===c||"/pro-basic"===c)a+='<a href="/memegenerator" class="b but">Meme Generator</a>';a+="</div>";BOX.show({html:a,w:400})}}})):showLogin("Your payment was accepted! Login or Signup below to choose which Imgflip account will be upgraded to Pro.",function(){g(b,a,d)})}function l(b){loading("Changing Payment Method");
$.ajax({url:"/ajax_pro_change_payment_method",type:"post",dataType:"json",data:{token:b.id},success:function(a){loading(!1);a.error?error_dialog(a.error):(BOX.hide(),MSG("Changed Payment Method Successfully!","green"))}})}function h(){return" ("+(I.user.id?"":"not ")+"logged in)"}window.initProStripe=function(b,a,d){var k=StripeCheckout.configure({key:"pk_live_6xZzt17AN4OiP5SW30T264Dy",image:"https://imgflip.com/favicon-pad-256.png?a",locale:"auto",token:function(b){d?l(b):(e(a,"Stripe Pay Success Card"+
h()),g(a,b,"Card"))}});$w.on("popstate",function(){k.close()});var c=Stripe("pk_live_6xZzt17AN4OiP5SW30T264Dy"),q=c.elements({locale:"auto"}),m="pro"===a?"":" Basic",n="pro"===a?995:395,c=c.paymentRequest({country:"US",currency:"usd",total:{amount:n,label:"Imgflip Pro"+m+" Monthly Subscription"},requestPayerName:!0,requestPayerEmail:!0}),f;c.on("token",function(b){b.complete("success");d?l(b.token):(e(a,"Stripe Pay Success PaymentRequest "+f+h()),g(a,b.token,"PaymentRequest "+f))});var r=q.create("paymentRequestButton",
{paymentRequest:c,style:{paymentRequestButton:{height:"32px"}}}),p=b.find(".pro-stripe-payment-btn");c.canMakePayment().then(function(b){b&&(p.removeClass("display-none"),r.mount(p[0]),f=JSON.stringify(b),d||e(a,"Stripe payment button loaded "+f))});b.on("click",".pro-stripe-btn",function(){I.done?!1!==I.user.can_subscribe||d?(d||e(a,"Stripe Clicked Buy"+h()),k.open({name:"Imgflip Pro"+m,description:"Monthly Subscription",amount:n,email:I.user.email})):(e(a,"Stripe already subscribed"),error_dialog("You already have an active subscription! If you are trying to change your payment method, visit imgflip.com/settings and click the Change Payment Method button. If you are trying to switch between Pro and Pro Basic, try canceling your current subscription first and then re-subscribing.")):
(d||e(a,"Stripe page not loaded"),error_dialog("Looks like our webpage hasn't finished loading yet. This can happen if your internet connection is slow or if a network error occurred. Try again in a couple seconds, or refresh the page."))})};var e=window.proEvent=function(b,a){_gaq.push(["_trackEvent","Pro",("pro"===b?"":"Basic ")+a,I.user.id?I.user.id+" | "+I.user.user:"anon"])};window.initProPaypal=function(){var b=!1;$(".pro-paypal-form").submit(function(){if(b)return!0;if(!I.done)return!1;if(!I.user.id)return _gaq.push(["_set",
"hitCallback",function(){window.location="/signup?redirect=/pro"}]),_gaq.push(["_trackEvent","Pro","Paypal Clicked Buy (not logged in)","anon"]),!1;if(!I.user.can_subscribe)return alert("Your account already has an active Pro subscription!"),!1;b=!0;var a=$(this);_gaq.push(["_set","hitCallback",function(){a.submit()}]);_gaq.push(["_trackEvent","Pro","Paypal Clicked Buy (logged in)",I.user.id+" | "+I.user.user]);return!1})}})();
